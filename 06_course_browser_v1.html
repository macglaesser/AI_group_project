<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cox School of Business - Course Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --acc-color: #FF6B6B;
            --fin-color: #4ECDC4;
            --mkt-color: #45B7D1;
            --mgt-color: #96CEB4;
            --bzan-color: #FFEAA7;
            --cs-color: #DDA0DD;
            --econ-color: #FFB6C1;
            --math-color: #87CEEB;
            --primary: #2C3E50;
            --secondary: #34495E;
            --light: #ECF0F1;
            --lighter: #F8F9FA;
            --border: #BDC3C7;
            --success: #27AE60;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--primary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 10px;
        }

        header p {
            color: var(--secondary);
            font-size: 1.1em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            font-size: 1.2em;
            color: var(--secondary);
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 0.95em;
        }

        input[type="text"],
        select {
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .course-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
        }

        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .course-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .course-code {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .course-dept-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .course-body {
            padding: 20px;
        }

        .course-name {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .course-description {
            color: var(--secondary);
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .course-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light);
        }

        .meta-item {
            font-size: 0.9em;
        }

        .meta-label {
            color: var(--secondary);
            font-weight: 600;
            display: block;
            font-size: 0.85em;
        }

        .meta-value {
            color: var(--primary);
            font-weight: 500;
            margin-top: 3px;
        }

        .dept-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
            margin-bottom: 10px;
        }

        .dept-ACC { background-color: var(--acc-color); }
        .dept-FIN { background-color: var(--fin-color); color: white; }
        .dept-MKT { background-color: var(--mkt-color); }
        .dept-MGT { background-color: var(--mgt-color); }
        .dept-BZAN { background-color: var(--bzan-color); color: #333; }
        .dept-CS { background-color: var(--cs-color); }
        .dept-ECON { background-color: var(--econ-color); }
        .dept-MATH { background-color: var(--math-color); }

        .prerequisites-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--light);
        }

        .section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .prerequisite-list {
            font-size: 0.85em;
            color: var(--primary);
            line-height: 1.6;
        }

        .prerequisite-item {
            background: var(--lighter);
            padding: 6px 10px;
            border-radius: 4px;
            margin-bottom: 4px;
            display: inline-block;
            margin-right: 4px;
        }

        .prerequisite-type {
            font-size: 0.75em;
            font-weight: 600;
            color: white;
            background: var(--secondary);
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 4px;
        }

        .schedules-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--light);
        }

        .schedule-item {
            background: var(--lighter);
            padding: 8px 10px;
            border-radius: 4px;
            margin-bottom: 6px;
            font-size: 0.85em;
        }

        .schedule-time {
            color: var(--secondary);
            font-weight: 600;
        }

        .schedule-days {
            color: var(--primary);
            font-weight: 500;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .no-results-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .no-results-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .no-results-text {
            color: var(--secondary);
            font-size: 1.1em;
        }

        .error-message {
            background: #FFE5E5;
            border: 2px solid #FF6B6B;
            color: #C92A2A;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 500;
        }

        .success-message {
            background: #E8F5E9;
            border: 2px solid var(--success);
            color: #2E7D32;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .courses-grid {
                grid-template-columns: 1fr;
            }

            .course-meta {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì Course Browser</h1>
            <p>Cox School of Business - Academic Course Assistant System</p>
        </header>

        <div id="dbStatus">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading database...</p>
            </div>
        </div>

        <div id="content" style="display: none;">
            <div class="controls">
                <div class="controls-grid">
                    <div class="control-group">
                        <label for="searchInput">üîç Search Courses</label>
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Search by name, code, or description..."
                        >
                    </div>
                    <div class="control-group">
                        <label for="deptFilter">üìö Filter by Department</label>
                        <select id="deptFilter">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="difficultyFilter">üìä Filter by Level</label>
                        <select id="difficultyFilter">
                            <option value="">All Levels</option>
                            <option value="INT">Introductory</option>
                            <option value="MID">Intermediate</option>
                            <option value="ADV">Advanced</option>
                        </select>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-primary" id="searchBtn">üîç Search</button>
                    <button class="btn-secondary" id="resetBtn">‚Üª Reset Filters</button>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">Total Courses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDepts">0</div>
                        <div class="stat-label">Departments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">Students</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="filteredCount">0</div>
                        <div class="stat-label">Showing</div>
                    </div>
                </div>
            </div>

            <div id="coursesContainer" class="courses-grid"></div>
            <div id="noResults" class="no-results" style="display: none;">
                <div class="no-results-icon">üì≠</div>
                <div class="no-results-title">No Courses Found</div>
                <div class="no-results-text">Try adjusting your search or filter criteria</div>
            </div>
        </div>

        <div id="errorContainer"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script>
        let db = null;
        let allCourses = [];
        let departmentMap = {};
        let difficultyMap = {};
        let scheduleMap = {};
        let prerequisiteMap = {};
        let studentMap = {};

        async function initDatabase() {
            try {
                // Wait for sql.js to load
                if (typeof window.SQL === 'undefined') {
                    setTimeout(initDatabase, 100);
                    return;
                }

                const SQL = window.SQL;
                
                // Initialize with embedded sample data (no database file needed)
                db = new SQL.Database();
                
                // Load sample data directly
                loadSampleData();
                
                document.getElementById('dbStatus').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                loadDepartments();
                loadDifficulties();
                loadCourses();
                loadStatistics();
                setupEventListeners();
                
            } catch (error) {
                showError('Database Error: ' + error.message);
            }
        }

        function loadSampleData() {
            // Sample data embedded in HTML
            const sampleData = {
                departments: [
                    { id: 1, code: 'ACC', name: 'Accounting' },
                    { id: 2, code: 'FIN', name: 'Finance' },
                    { id: 3, code: 'MKT', name: 'Marketing' },
                    { id: 4, code: 'MGT', name: 'Management' },
                    { id: 5, code: 'BZAN', name: 'Business Analytics' },
                    { id: 6, code: 'CS', name: 'Computer Science' },
                    { id: 7, code: 'ECON', name: 'Economics' },
                    { id: 8, code: 'MATH', name: 'Mathematics' }
                ],
                difficulties: [
                    { id: 1, code: 'INT', name: 'Introductory' },
                    { id: 2, code: 'MID', name: 'Intermediate' },
                    { id: 3, code: 'ADV', name: 'Advanced' }
                ],
                courses: [
                    // Accounting
                    { id: 1, code: 'ACCT 2301', name: 'Intro to Financial Accounting', desc: 'Foundational accounting principles and financial statement preparation', dept: 1, diff: 1, credits: 3, status: 'Active' },
                    { id: 2, code: 'ACCT 2302', name: 'Intro to Managerial Accounting', desc: 'Cost accounting and management decision-making', dept: 1, diff: 1, credits: 3, status: 'Active' },
                    { id: 3, code: 'ACCT 3301', name: 'Intermediate Financial Accounting', desc: 'Advanced financial accounting concepts and standards', dept: 1, diff: 2, credits: 3, status: 'Active' },
                    { id: 4, code: 'ACCT 4301', name: 'Advanced Financial Accounting', desc: 'Complex accounting transactions and consolidations', dept: 1, diff: 3, credits: 3, status: 'Active' },
                    { id: 5, code: 'ACCT 4302', name: 'Auditing Principles', desc: 'Audit procedures and professional standards', dept: 1, diff: 3, credits: 3, status: 'Active' },
                    { id: 6, code: 'ACCT 4303', name: 'Taxation', desc: 'Individual and corporate tax planning', dept: 1, diff: 3, credits: 3, status: 'Active' },
                    // Finance
                    { id: 7, code: 'FIN 2301', name: 'Principles of Finance', desc: 'Time value of money and financial decision making', dept: 2, diff: 1, credits: 3, status: 'Active' },
                    { id: 8, code: 'FIN 3301', name: 'Corporate Finance', desc: 'Capital budgeting and investment analysis', dept: 2, diff: 2, credits: 3, status: 'Active' },
                    { id: 9, code: 'FIN 3302', name: 'Investments', desc: 'Portfolio theory and security analysis', dept: 2, diff: 2, credits: 3, status: 'Active' },
                    { id: 10, code: 'FIN 4301', name: 'Advanced Corporate Finance', desc: 'Mergers, acquisitions, and valuation', dept: 2, diff: 3, credits: 3, status: 'Active' },
                    { id: 11, code: 'FIN 4302', name: 'International Finance', desc: 'Foreign exchange and global financial markets', dept: 2, diff: 3, credits: 3, status: 'Active' },
                    { id: 12, code: 'FIN 4303', name: 'Financial Risk Management', desc: 'Derivatives and risk hedging strategies', dept: 2, diff: 3, credits: 3, status: 'Active' },
                    // Marketing
                    { id: 13, code: 'MKT 2301', name: 'Principles of Marketing', desc: 'Marketing fundamentals and strategy', dept: 3, diff: 1, credits: 3, status: 'Active' },
                    { id: 14, code: 'MKT 3301', name: 'Market Research', desc: 'Quantitative and qualitative research methods', dept: 3, diff: 2, credits: 3, status: 'Active' },
                    { id: 15, code: 'MKT 3302', name: 'Digital Marketing', desc: 'Social media, SEO, and online advertising', dept: 3, diff: 2, credits: 3, status: 'Active' },
                    { id: 16, code: 'MKT 4301', name: 'Strategic Marketing', desc: 'Brand strategy and competitive positioning', dept: 3, diff: 3, credits: 3, status: 'Active' },
                    // Management/Business
                    { id: 17, code: 'MGT 2301', name: 'Principles of Management', desc: 'Management fundamentals and organizational structure', dept: 4, diff: 1, credits: 3, status: 'Active' },
                    { id: 18, code: 'MGT 3301', name: 'Organizational Behavior', desc: 'Motivation, groups, and organizational dynamics', dept: 4, diff: 2, credits: 3, status: 'Active' },
                    { id: 19, code: 'BZAN 2301', name: 'Intro to Business Analytics', desc: 'Data analysis fundamentals for business', dept: 5, diff: 1, credits: 3, status: 'Active' },
                    { id: 20, code: 'BZAN 3301', name: 'Data Mining', desc: 'Predictive analytics and data exploration', dept: 5, diff: 2, credits: 3, status: 'Active' },
                    // Computer Science
                    { id: 21, code: 'CS 1301', name: 'Intro to Computer Science', desc: 'Fundamentals of programming and computation', dept: 6, diff: 1, credits: 3, status: 'Active' },
                    { id: 22, code: 'CS 1302', name: 'Computer Programming', desc: 'Object-oriented programming in Python', dept: 6, diff: 1, credits: 3, status: 'Active' },
                    { id: 23, code: 'CS 2301', name: 'Data Structures', desc: 'Arrays, linked lists, trees, and algorithms', dept: 6, diff: 2, credits: 3, status: 'Active' },
                    { id: 24, code: 'CS 4301', name: 'Artificial Intelligence', desc: 'Machine learning and AI fundamentals', dept: 6, diff: 3, credits: 3, status: 'Active' },
                    // Economics & Math
                    { id: 25, code: 'ECON 2301', name: 'Principles of Microeconomics', desc: 'Consumer behavior and market equilibrium', dept: 7, diff: 1, credits: 3, status: 'Active' },
                    { id: 26, code: 'ECON 2302', name: 'Principles of Macroeconomics', desc: 'National income and economic growth', dept: 7, diff: 1, credits: 3, status: 'Active' },
                    { id: 27, code: 'ECON 3301', name: 'Intermediate Microeconomics', desc: 'Advanced supply and demand analysis', dept: 7, diff: 2, credits: 3, status: 'Active' },
                    { id: 28, code: 'MATH 1309', name: 'College Algebra', desc: 'Functions, equations, and mathematical modeling', dept: 8, diff: 1, credits: 3, status: 'Active' },
                    { id: 29, code: 'MATH 2309', name: 'Precalculus', desc: 'Trigonometry and advanced algebra', dept: 8, diff: 1, credits: 3, status: 'Active' },
                    { id: 30, code: 'STAT 2301', name: 'Business Statistics', desc: 'Probability, distributions, and hypothesis testing', dept: 8, diff: 1, credits: 3, status: 'Active' }
                ],
                prerequisites: [
                    { courseId: 3, prereqId: 1, type: 'Hard', grade: 'C' },
                    { courseId: 4, prereqId: 3, type: 'Hard', grade: 'C' },
                    { courseId: 5, prereqId: 3, type: 'Hard', grade: 'C' },
                    { courseId: 8, prereqId: 7, type: 'Hard', grade: 'C' },
                    { courseId: 9, prereqId: 7, type: 'Hard', grade: 'C' },
                    { courseId: 10, prereqId: 8, type: 'Hard', grade: 'C' },
                    { courseId: 11, prereqId: 8, type: 'Hard', grade: 'C' },
                    { courseId: 12, prereqId: 8, type: 'Hard', grade: 'C' },
                    { courseId: 12, prereqId: 30, type: 'Hard', grade: 'C' },
                    { courseId: 14, prereqId: 13, type: 'Hard', grade: 'C' },
                    { courseId: 15, prereqId: 13, type: 'Hard', grade: 'C' },
                    { courseId: 16, prereqId: 14, type: 'Hard', grade: 'C' },
                    { courseId: 19, prereqId: 28, type: 'Hard', grade: 'C' },
                    { courseId: 20, prereqId: 19, type: 'Hard', grade: 'C' },
                    { courseId: 20, prereqId: 30, type: 'Hard', grade: 'C' },
                    { courseId: 22, prereqId: 21, type: 'Hard', grade: 'C' },
                    { courseId: 23, prereqId: 22, type: 'Hard', grade: 'C' },
                    { courseId: 24, prereqId: 23, type: 'Hard', grade: 'C' },
                    { courseId: 29, prereqId: 28, type: 'Hard', grade: 'C' },
                    { courseId: 30, prereqId: 28, type: 'Hard', grade: 'C' },
                    { courseId: 27, prereqId: 25, type: 'Hard', grade: 'C' }
                ],
                schedules: [
                    { courseId: 1, semester: 'Fall2024', section: '01', professor: 'Dr. Patricia Chen', days: 'MW', startTime: '09:00', endTime: '10:30', location: 'Cox 101' },
                    { courseId: 1, semester: 'Fall2024', section: '02', professor: 'Dr. Michael Torres', days: 'TR', startTime: '13:00', endTime: '14:30', location: 'Cox 102' },
                    { courseId: 8, semester: 'Spring2025', section: '01', professor: 'Dr. Robert Lee', days: 'TR', startTime: '13:00', endTime: '14:30', location: 'Cox 102' },
                    { courseId: 14, semester: 'Spring2025', section: '01', professor: 'Dr. Jennifer Kim', days: 'TR', startTime: '15:00', endTime: '16:30', location: 'Cox 104' },
                    { courseId: 19, semester: 'Fall2024', section: '01', professor: 'Dr. Rajesh Patel', days: 'TR', startTime: '14:00', endTime: '15:30', location: 'Cox 104' },
                    { courseId: 22, semester: 'Spring2025', section: '01', professor: 'Dr. David Miller', days: 'MWF', startTime: '14:00', endTime: '14:50', location: 'Cox 105' }
                ],
                students: [
                    { id: 10001, name: 'Alex Chen', email: 'achen@smu.edu', major: 1, gpa: 3.65, credits: 66 },
                    { id: 10002, name: 'Jordan Rodriguez', email: 'jrodriguez@smu.edu', major: 3, gpa: 3.52, credits: 95 },
                    { id: 10003, name: 'Sam Patel', email: 'spatel@smu.edu', major: 5, gpa: 3.78, credits: 48 }
                ],
                academicHistory: [
                    { studentId: 10001, courseId: 28 },
                    { studentId: 10001, courseId: 30 },
                    { studentId: 10001, courseId: 1 },
                    { studentId: 10001, courseId: 7 },
                    { studentId: 10001, courseId: 3 },
                    { studentId: 10002, courseId: 28 },
                    { studentId: 10002, courseId: 25 },
                    { studentId: 10002, courseId: 19 },
                    { studentId: 10002, courseId: 20 },
                    { studentId: 10003, courseId: 28 },
                    { studentId: 10003, courseId: 21 },
                    { studentId: 10003, courseId: 22 },
                    { studentId: 10003, courseId: 23 }
                ]
            };

            // Store data in global maps for easy access
            sampleData.departments.forEach(d => {
                departmentMap[d.id] = d;
            });

            sampleData.difficulties.forEach(d => {
                difficultyMap[d.id] = d;
            });

            sampleData.students.forEach(s => {
                studentMap[s.id] = s;
            });

            sampleData.prerequisites.forEach(p => {
                if (!prerequisiteMap[p.courseId]) {
                    prerequisiteMap[p.courseId] = [];
                }
                prerequisiteMap[p.courseId].push(p);
            });

            sampleData.schedules.forEach(s => {
                if (!scheduleMap[s.courseId]) {
                    scheduleMap[s.courseId] = [];
                }
                scheduleMap[s.courseId].push(s);
            });

            allCourses = sampleData.courses;
        }

        function loadDepartments() {
            const select = document.getElementById('deptFilter');
            const depts = new Set();
            
            allCourses.forEach(course => {
                const dept = departmentMap[course.dept];
                if (dept) depts.add(dept.code + '|' + dept.name);
            });

            Array.from(depts).sort().forEach(dept => {
                const [code, name] = dept.split('|');
                const option = document.createElement('option');
                option.value = code;
                option.textContent = `${code} - ${name}`;
                select.appendChild(option);
            });
        }

        function loadDifficulties() {
            // Already handled in HTML
        }

        function loadCourses() {
            displayCourses(allCourses);
        }

        function loadStatistics() {
            document.getElementById('totalCourses').textContent = allCourses.length;
            document.getElementById('totalDepts').textContent = Object.keys(departmentMap).length;
            document.getElementById('totalStudents').textContent = Object.keys(studentMap).length;
        }

        function displayCourses(courses) {
            const container = document.getElementById('coursesContainer');
            const noResults = document.getElementById('noResults');
            
            container.innerHTML = '';
            
            if (courses.length === 0) {
                noResults.style.display = 'block';
                document.getElementById('filteredCount').textContent = '0';
                return;
            }
            
            noResults.style.display = 'none';
            document.getElementById('filteredCount').textContent = courses.length;

            courses.forEach(course => {
                const dept = departmentMap[course.dept];
                const difficulty = difficultyMap[course.diff];
                const prereqs = prerequisiteMap[course.id] || [];
                const schedules = scheduleMap[course.id] || [];

                const card = document.createElement('div');
                card.className = 'course-card';
                
                let prereqHTML = '';
                if (prereqs.length > 0) {
                    prereqHTML = `
                        <div class="prerequisites-section">
                            <div class="section-title">üìã Prerequisites</div>
                            <div class="prerequisite-list">
                                ${prereqs.map(p => {
                                    const prereqCourse = allCourses.find(c => c.id === p.prereqId);
                                    return `
                                        <div class="prerequisite-item">
                                            <span class="prerequisite-type">${p.type}</span>
                                            ${prereqCourse ? prereqCourse.code : 'Course ' + p.prereqId}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }

                let scheduleHTML = '';
                if (schedules.length > 0) {
                    scheduleHTML = `
                        <div class="schedules-section">
                            <div class="section-title">üìÖ Schedule</div>
                            ${schedules.map(s => `
                                <div class="schedule-item">
                                    <span class="schedule-days">${s.days}</span> 
                                    <span class="schedule-time">${s.startTime} - ${s.endTime}</span>
                                    <br>
                                    <small>${s.professor} | ${s.semester}</small>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="course-header">
                        <div class="course-code">${course.code}</div>
                        <span class="course-dept-badge">${dept ? dept.code : 'N/A'}</span>
                    </div>
                    <div class="course-body">
                        <div class="course-name">${course.name}</div>
                        <div class="course-description">${course.desc}</div>
                        
                        <div class="course-meta">
                            <div class="meta-item">
                                <span class="meta-label">Credits</span>
                                <span class="meta-value">${course.credits}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Level</span>
                                <span class="meta-value">${difficulty ? difficulty.name : 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Department</span>
                                <span class="meta-value">${dept ? dept.name : 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Status</span>
                                <span class="meta-value" style="color: var(--success);">‚úì ${course.status}</span>
                            </div>
                        </div>
                        
                        ${prereqHTML}
                        ${scheduleHTML}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        function filterAndSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const deptFilter = document.getElementById('deptFilter').value;
            const diffFilter = document.getElementById('difficultyFilter').value;

            const filtered = allCourses.filter(course => {
                const matchesSearch = !searchTerm || 
                    course.code.toLowerCase().includes(searchTerm) ||
                    course.name.toLowerCase().includes(searchTerm) ||
                    course.desc.toLowerCase().includes(searchTerm);

                const matchesDept = !deptFilter || 
                    departmentMap[course.dept]?.code === deptFilter;

                const matchesDiff = !diffFilter || 
                    difficultyMap[course.diff]?.code === diffFilter;

                return matchesSearch && matchesDept && matchesDiff;
            });

            displayCourses(filtered);
        }

        function setupEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', filterAndSearch);
            document.getElementById('searchInput').addEventListener('keypress', e => {
                if (e.key === 'Enter') filterAndSearch();
            });
            document.getElementById('deptFilter').addEventListener('change', filterAndSearch);
            document.getElementById('difficultyFilter').addEventListener('change', filterAndSearch);
            
            document.getElementById('resetBtn').addEventListener('click', () => {
                document.getElementById('searchInput').value = '';
                document.getElementById('deptFilter').value = '';
                document.getElementById('difficultyFilter').value = '';
                displayCourses(allCourses);
            });
        }

        function showError(message) {
            const container = document.getElementById('errorContainer');
            container.innerHTML = `<div class="error-message">‚ùå ${message}</div>`;
            document.getElementById('dbStatus').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        // Initialize when page loads
        window.addEventListener('load', initDatabase);
    </script>
</body>
</html>
